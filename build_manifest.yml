noir:
  buildDir: noir
  rebuildPatterns:
    - ^noir/Dockerfile
    - ^noir/acvm-repo
    - ^noir/compiler
    - ^noir/aztec_macros
    - ^noir/noir_stdlib
    - ^noir/tooling/backend_interface
    - ^noir/tooling/bb_abstraction_leaks
    - ^noir/tooling/debugger
    - ^noir/tooling/lsp
    - ^noir/tooling/nargo
    - ^noir/tooling/nargo_cli
    - ^noir/tooling/nargo_toml
    - ^noir/tooling/nargo_fmt
    - ^noir/tooling/noirc_abi
  multiarch: host

noir-packages:
  buildDir: noir
  dockerfile: Dockerfile.packages
  rebuildPatterns:
    - ^noir/Dockerfile.packages
    - ^noir/.yarn
    - ^noir/.yarnrc.yml
    - ^noir/package.json
    - ^noir/yarn.lock
    - ^noir/acvm-repo
    - ^noir/compiler
    - ^noir/aztec_macros
    - ^noir/noir_stdlib
    - ^noir/tooling/noir_codegen
    - ^noir/tooling/noir_js
    - ^noir/tooling/noir_js_backend_barretenberg
    - ^noir/tooling/noir_js_types
    - ^noir/tooling/noirc_abi
    - ^noir/tooling/noirc_abi_wasm

noir-projects:
  buildDir: noir-projects
  dependencies:
    - noir
    - avm-transpiler

noir-compile-acir-tests:
  buildDir: noir/test_programs
  # Awkward. Maybe change dockerfile paths to be absolute.
  dockerfile: ../../barretenberg/acir_tests/Dockerfile.noir_acir_tests
  rebuildPatterns:
    - ^noir/test_programs
    - ^barretenberg/acir_tests/Dockerfile.noir_acir_tests
  dependencies:
    - noir

barretenberg-asan-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.assert-build
  rebuildPatterns: .rebuild_patterns

barretenberg-assert-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.assert-build
  rebuildPatterns: .rebuild_patterns

barretenberg-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.build
  rebuildPatterns: .rebuild_patterns

barretenberg-fuzzing-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.fuzzing-build
  rebuildPatterns: .rebuild_patterns

barretenberg-gcc-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.gcc-build
  rebuildPatterns: .rebuild_patterns

barretenberg-msan-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.msan-build
  rebuildPatterns: .rebuild_patterns

barretenberg-op-count-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.op-count-build
  rebuildPatterns: .rebuild_patterns

barretenberg-tsan-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.tsan-build
  rebuildPatterns: .rebuild_patterns

barretenberg-ubsan-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.ubsan-build
  rebuildPatterns: .rebuild_patterns

barretenberg-wasm-build:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.wasm-build
  rebuildPatterns: .rebuild_patterns

barretenberg-solidity-verifier:
  buildDir: barretenberg
  dockerfile: sol/Dockerfile
  rebuildPatterns: sol/.rebuild_patterns

bb.js:
  buildDir: barretenberg/ts
  dependencies:
    - barretenberg-wasm-build

barretenberg-acir-tests-bb:
  buildDir: barretenberg/acir_tests
  dockerfile: Dockerfile.bb
  dependencies:
    - barretenberg-assert-build
    - noir-compile-acir-tests

# TODO(AD) this is unused?
barretenberg-acir-tests-bb-solidity:
  buildDir: barretenberg/acir_tests
  dockerfile: Dockerfile.bb.sol
  dependencies:
    - barretenberg-assert-build
    - barretenberg-solidity-verifier
    - noir-compile-acir-tests

barretenberg-acir-tests-bb.js:
  buildDir: barretenberg/acir_tests
  dockerfile: Dockerfile.bb.js
  dependencies:
    - bb.js
    - noir-compile-acir-tests

barretenberg-bench:
  buildDir: barretenberg/cpp
  dockerfile: dockerfiles/Dockerfile.bench
  dependencies:
    - barretenberg-op-count-build

barretenberg-docs:
  buildDir: barretenberg/cpp
  dockerfile: docs/Dockerfile

l1-contracts:
  buildDir: l1-contracts

boxes-files:
  buildDir: boxes
  dockerfile: Dockerfile.files

yarn-project-base:
  buildDir: yarn-project
  projectDir: yarn-project/yarn-project-base
  rebuildPatterns:
    - ^yarn-project/yarn-project-base/
    - ^yarn-project/yarn.lock
    - ^yarn-project/.*/package.json$
  dependencies:
    - l1-contracts
    - bb.js
    - noir
    - noir-packages
    - boxes-files
    - avm-transpiler
    - noir-projects

yarn-project:
  buildDir: yarn-project
  rebuildPatterns:
    - ^yarn-project/.*\.(ts|tsx|js|cjs|mjs|json|html|md|sh|nr|toml)$
    - ^yarn-project/Dockerfile$
    - ^yarn-project/cli/aztec-cli
  dependencies:
    - yarn-project-base

yarn-project-prod:
  buildDir: yarn-project
  dockerfile: Dockerfile.prod
  rebuildPatterns:
    - ^yarn-project/Dockerfile.prod
  dependencies:
    - yarn-project
  multiarch: buildx

aztec:
  buildDir: yarn-project
  projectDir: yarn-project/aztec
  dependencies:
    - yarn-project-prod
  multiarch: buildx

aztec-faucet:
  buildDir: yarn-project
  projectDir: yarn-project/aztec-faucet
  dependencies:
    - yarn-project-prod

cli:
  buildDir: yarn-project
  projectDir: yarn-project/cli
  dependencies:
    - yarn-project-prod
  multiarch: buildx

boxes:
  buildDir: boxes
  dependencies:
    - aztec
    - noir
    - noir-projects
  runDependencies:
    - aztec

end-to-end:
  buildDir: yarn-project
  projectDir: yarn-project/end-to-end
  dependencies:
    - yarn-project
  runDependencies:
    - aztec

mainnet-fork:
  buildDir: iac/mainnet-fork
  projectDir: iac/mainnet-fork

docs:
  buildDir: .
  dockerfile: docs/Dockerfile
  rebuildPatterns:
    - ^docs/
    - ^.*.cpp$
    - ^.*.hpp$
    - ^.*.ts$
    - ^.release-please-manifest.json$
    - ^.*.nr$
  dependencies:
    - yarn-project
    - noir-projects

yellow-paper:
  buildDir: yellow-paper
  rebuildPatterns:
    - ^yellow-paper/

avm-transpiler:
  buildDir: .
  dockerfile: avm-transpiler/Dockerfile
  rebuildPatterns:
    - ^avm-transpiler/
    - ^noir/
